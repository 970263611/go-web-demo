package handler

import (
	"github.com/gin-gonic/gin"
	"project/handler/auth"
	"project/handler/filter"
	"project/handler/health"
	"project/handler/picture"
)

func Do(router *gin.Engine) {
	router.Use(Cors())
	//健康检查
	router.GET(
		"/health",
		health.Check,
	)
	//登录
	router.POST(
		"/login",
		auth.Login,
	)
	//添加token验证
	router.Use(filter.AuthFilter())
	//修改用户密码
	router.POST(
		"/resetPass",
		auth.Reset,
	)
	//获取用户信息
	router.POST(
		"/getUserInfo",
		auth.Info,
	)
	userGroup := router.Group("/user")
	//搜索用户
	userGroup.POST(
		"/search",
		auth.Search,
	)
	//新增用户
	userGroup.POST(
		"/add",
		auth.Add,
	)
	//更新用户
	userGroup.POST(
		"/update",
		auth.Update,
	)
	//删除用户
	userGroup.POST(
		"/delete",
		auth.Delete,
	)
	//移交管理员
	router.POST(
		"/change/admin",
		auth.AdminChange,
	)
	//重置密码
	router.POST(
		"/reset/password",
		auth.ResetPassword,
	)
	//评分上升和下降列表
	listGroup := router.Group("list")
	listGroup.POST(
		"/score",
		picture.Score,
	)
	//风险预警列表接口
	listGroup.POST(
		"/risk",
		picture.Risk,
	)
	//首页主图列表
	listGroup.POST(
		"/select",
		picture.Select,
	)
	//人员增减动态变化图接口
	listGroup.POST(
		"/upAndDown",
		picture.UpAndDown,
	)
	//高潜人才接口
	listGroup.POST(
		"/personalEchart",
		picture.PersonalEchart,
	)
	//员工个人页基本信息
	listGroup.POST(
		"/steps",
		picture.Steps,
	)
	//个人标签云图接口
	listGroup.POST(
		"/cloud",
		picture.Cloud,
	)
	//个人轨迹接口
	listGroup.POST(
		"/history",
		picture.History,
	)
	//个人历史分值
	listGroup.POST(
		"/userDetails",
		picture.UserDetails,
	)
	//处室员工列表接口接口
	listGroup.POST(
		"/depart",
		picture.Depart,
	)
	//离职原因接口
	router.POST(
		"/risk/reason",
		picture.RiskReason,
	)
}

func Cors() gin.HandlerFunc {
	return func(c *gin.Context) {
		c.Writer.Header().Add("Access-Control-Allow-Origin", "*")
		c.Next()
	}
}
